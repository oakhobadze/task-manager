{% extends "base.html" %}
{% load crispy_forms_filters %}

{% block content %}
<div class="container mt-4">
<form method="get" action="" class="form-inline">
    {{ search_form|crispy }}
    <input type="submit" value="find" class="btn btn-secondary">
</form>
<br>
    <div class="d-flex justify-content-between align-items-center">
        <h2>Task List</h2>
        <a href="{% url 'manager:tasks-create' %}" class="btn btn-success">Add Task</a>
    </div>

    {% if task_list %}
      <table class="table table-bordered table-striped">
        <thead>
          <tr>
            <th>Name</th>
            <th>Description</th>
            <th>Deadline</th>
            <th>Completed</th>
            <th>Priority</th>
            <th>Task Type</th>
            <th>Assignees</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for task in task_list %}
          <tr>
            <td>
              <a href="{% url 'manager:tasks-detail' task.id %}">
                {{ task.name }}
              </a>
            </td>
            <td>{{ task.description }}</td>
            <td>{{ task.deadline|date:"d.m.Y H:i" }}</td>
            <td>
              {% if task.is_completed %}
                ✅ Yes
              {% else %}
                ❌ No
              {% endif %}
            </td>
            <td><span class="badge bg-primary">{{ task.priority }}</span></td>
            <td>{{ task.task_type.name }}</td>
            <td>
              {% for worker in task.assignees.all %}
                {{ worker.username }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </td>
            <td>
              <a href="{% url 'manager:tasks-delete' task.id %}" class="btn btn-danger btn-sm">
                Delete
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No tasks available.</p>
    {% endif %}
    <a href="{% url 'manager:index' %}" class="btn btn-secondary mt-3">Back to Home</a>
</div>
{% endblock %}
